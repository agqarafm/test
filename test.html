<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kalkulyator | Kart · Qalıq · Qeydlər</title>
  <style>
    /*
     * Yeni Dizayn: Neon Stil Tünd Mövzu
     */
    :root{
      --bg-color: #0d1222;            /* Əsas Fon */
      --panel-bg: #1a223a;            /* Panel Fonu */
      --card-bg: #151c33;             /* Kart Fonu */
      --text-main: #f0f4ff;           /* Əsas Mətn */
      --text-muted: #94a3b8;          /* İkinci Dərəcəli Mətn */
      --accent-color: #8c9eff;        /* Vurğu / Neon Mavi */
      --accent-shadow: 0 0 10px rgba(140, 158, 255, 0.5); /* Vurğu Kölgəsi */
      --border-color: #2e3a5a;
      --shadow-lg: 0 10px 30px rgba(0,0,0,.45);
      --radius-xl: 16px;
    }

    *{ box-sizing: border-box; }
    html,body{ height: 100%; }
    body{
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1000px 500px at 5% 5%, #182343 0%, transparent 45%),
                  radial-gradient(1000px 500px at 95% 5%, #2a1843 0%, transparent 45%),
                  var(--bg-color);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .container{ max-width: 1000px; margin: 40px auto; padding: 0 16px; }

    /* Navigasiya / Menyu */
    .nav{
      position: sticky; top: 20px; z-index: 50;
      display: flex; gap: 16px; align-items: center; justify-content: space-between;
      background: rgba(26, 34, 58, 0.8);
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-lg);
      padding: 14px 18px; border-radius: 20px;
      backdrop-filter: blur(8px);
    }
    .brand{ display: flex; gap: 10px; align-items: center; font-weight: 700; font-size: 1.15em; }
    .brand svg{ fill: var(--accent-color); filter: drop-shadow(0 0 5px var(--accent-color)); }

    .tabs{ display: flex; gap: 10px; }

    .tab{
      padding: 10px 18px; border-radius: 999px; cursor: pointer;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      color: var(--text-muted);
      font-weight: 600;
      transition: all .2s ease;
      user-select: none;
      box-shadow: inset 0 0 0 0 transparent;
    }
    .tab:hover{
      border-color: var(--accent-color);
      color: var(--text-main);
      box-shadow: 0 0 15px rgba(140, 158, 255, 0.2);
    }
    .tab.active{
      border-color: var(--accent-color);
      color: var(--text-main);
      box-shadow: var(--accent-shadow), inset 0 0 15px rgba(140, 158, 255, 0.4);
      background: #232c45;
    }

    /* Açılan Panel */
    .dropdown{ margin-top: 20px; }
    .panel{
      overflow: hidden;
      max-height: 0; opacity: 0; transform: translateY(-10px);
      transition: max-height .5s cubic-bezier(.2,.8,.2,1), opacity .4s ease, transform .4s ease;
      background: var(--panel-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
    }
    .panel.open{ max-height: 1200px; opacity: 1; transform: translateY(0); }
    .panel-inner{ padding: 24px; display: grid; gap: 20px; }

    .grid{ display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }
    .col-4{ grid-column: span 4; }
    .col-6{ grid-column: span 6; }
    .col-12{ grid-column: span 12; }
    @media (max-width: 860px){ .col-4, .col-6{ grid-column: span 12; } }

    .card{
      background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px;
      padding: 18px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.05);
    }

    .headline{ font-size: 22px; font-weight: 800; margin: 0 0 8px; color: var(--accent-color); }
    .muted{ color: var(--text-muted); font-size: 14px; }

    label{ display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-main); }

    .input{
      width: 100%; padding: 12px 14px; border-radius: 10px; outline: none;
      background: #101529; color: var(--text-main); font-size: 16px; border: 1px solid var(--border-color);
      transition: box-shadow .2s ease, border-color .2s ease;
    }
    .input:focus{ border-color: var(--accent-color); box-shadow: 0 0 0 4px rgba(140, 158, 255, 0.3); }

    .row{ display: flex; gap: 10px; align-items: center; }

    .btn{
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px 18px; border-radius: 10px; cursor: pointer; border: none;
      background: linear-gradient(135deg, #7c8fff 0%, #a2b6ff 100%);
      color: var(--bg-color); font-weight: 700;
      transition: transform .12s ease, box-shadow .2s ease, opacity .2s;
      box-shadow: 0 6px 15px rgba(140, 158, 255, 0.35);
    }
    .btn:hover{ opacity: .9; }
    .btn:active{ transform: translateY(1px); box-shadow: 0 3px 10px rgba(140, 158, 255, 0.35); }

    .btn.ghost{
      background: transparent; border: 1px solid var(--border-color); color: var(--text-main);
      box-shadow: none; font-weight: 600;
    }
    .btn.ghost:hover{ background: #232c45; border-color: var(--accent-color); }

    .tag{ font-size: 13px; padding: 6px 12px; border-radius: 999px; border: 1px solid #3d4a6c; background: #1f2740; color: var(--text-muted); }

    /* Modal */
    .modal-backdrop{ position: fixed; inset: 0; background: rgba(0,0,0,.7); display: none; align-items: center; justify-content: center; z-index: 100; }
    .modal-backdrop.show{ display: flex; animation: fadeIn .2s ease; }
    .modal{
      width: min(450px, calc(100vw - 28px));
      background: var(--panel-bg);
      border: 2px solid var(--accent-color);
      border-radius: var(--radius-xl);
      box-shadow: var(--accent-shadow), var(--shadow-lg);
      transform: translateY(10px) scale(.95); opacity: 0; animation: pop .25s ease forwards;
    }
    .modal-header{ display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid #3d4a6c; }
    .modal-title{ font-weight: 800; font-size: 1.2em; color: var(--accent-color); }
    .modal-body{ padding: 20px; }

    @keyframes fadeIn{ from{ opacity:0 } to{ opacity:1 } }
    @keyframes pop{ to{ transform: translateY(0) scale(1); opacity:1 } }

    /* Toast */
    .toast{ position: fixed; right: 20px; bottom: 20px; background: var(--card-bg); border: 1px solid var(--accent-color); color: var(--text-main); padding: 12px 18px; border-radius: 10px; box-shadow: var(--shadow-lg), var(--accent-shadow); opacity: 0; transform: translateY(10px); transition: .3s; z-index: 120; }
    .toast.show{ opacity: 1; transform: translateY(0); }

    /* Qeydlər listi */
    .notes-list{ display: grid; gap: 12px; }
    .note-item{
      display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: start;
      background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 12px;
    }
    .note-item.editing .note-text{ border-color: #3f51b5 !important; background: #101529 !important; }
    .note-text{ transition: all .2s; }
    .note-actions{ display: flex; gap: 8px; flex-shrink: 0; }
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="brand" title="Tam işlək yerli yaddaşlı tətbiq">
        <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2l2.39 4.84 5.34.78-3.86 3.76.91 5.3L12 14.77 7.22 16.68l.91-5.3L4.27 7.62l5.34-.78L12 2z"/>
        </svg>
        <div>Kalkulyator</div>
      </div>
      <div class="tabs" role="tablist" aria-label="Menyu">
        <button class="tab active" data-target="#tab-kart" role="tab" aria-selected="true">Kart məbləğ</button>
        <button class="tab" data-target="#tab-smart" role="tab" aria-selected="false">Smart qalıq</button>
        <button class="tab" data-target="#tab-notes" role="tab" aria-selected="false">Qeydlər</button>
      </div>
    </nav>

    <div class="dropdown">
      <section id="tab-kart" class="panel open" aria-hidden="false">
        <div class="panel-inner">
          <div class="headline">Kart Məbləğlərinin Cəmi</div>
          <div class="muted">Aidə, Gülşad və Arzu üçün məbləğləri daxil edin. Dəyərlər avtomatik yadda saxlanılır.</div>

          <div class="grid" style="margin-top: 10px;">
            <div class="col-4">
              <div class="card">
                <label for="aide">Aidə</label>
                <input id="aide" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-4">
              <div class="card">
                <label for="gulshad">Gülşad</label>
                <input id="gulshad" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-4">
              <div class="card">
                <label for="arzu">Arzu</label>
                <input id="arzu" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-12 row" style="justify-content:space-between; margin-top: 5px;">
              <div class="tag" id="kart-status">Avtoyaddaş aktivdir</div>
              <div class="row">
                <button class="btn" id="btn-kart-calc">Hesabla</button>
                <button class="btn ghost" id="btn-kart-reset" title="Məbləğləri sıfırla">Sıfırla</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="dropdown">
      <section id="tab-smart" class="panel" aria-hidden="true">
        <div class="panel-inner">
          <div class="headline">Smart Qalıqların Hesablanması</div>
          <div class="muted">2 nağd və 2 kart məbləğini daxil edin. Dəyərlər avtomatik yadda saxlanılır.</div>

          <div class="grid" style="margin-top: 10px;">
            <div class="col-6">
              <div class="card">
                <label for="cash1">Nağd məbləğ 1</label>
                <input id="cash1" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-6">
              <div class="card">
                <label for="cash2">Nağd məbləğ 2</label>
                <input id="cash2" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-6">
              <div class="card">
                <label for="card1">Kart məbləği 1</label>
                <input id="card1" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-6">
              <div class="card">
                <label for="card2">Kart məbləği 2</label>
                <input id="card2" class="input" inputmode="decimal" placeholder="0.00" />
              </div>
            </div>
            <div class="col-12 row" style="justify-content:space-between; margin-top: 5px;">
              <div class="tag" id="smart-status">Avtoyaddaş aktivdir</div>
              <div class="row">
                <button class="btn" id="btn-smart-calc">Hesabla</button>
                <button class="btn ghost" id="btn-smart-reset" title="Dəyərləri sıfırla">Sıfırla</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="dropdown">
      <section id="tab-notes" class="panel" aria-hidden="true">
        <div class="panel-inner">
          <div class="headline">Gündəlik Qeydlər</div>
          <div class="muted">Qeydlər yerli olaraq yadda saxlanılır. Redaktə etmək və silmək mümkündür.</div>

          <div class="card">
            <label for="note-text">Yeni qeyd əlavə et</label>
            <textarea id="note-text" class="input note-text" rows="3" placeholder="Məsələn: 02.09.2025 üçün plan..."></textarea>
            <div class="row" style="justify-content:space-between; margin-top:15px;">
              <div class="tag" id="notes-status">Avtoyaddaş aktivdir</div>
              <button class="btn" id="add-note">Qeydi Əlavə Et</button>
            </div>
          </div>

          <div class="notes-list" id="notes-list" aria-live="polite"></div>
        </div>
      </section>
    </div>
  </div>

  <div class="modal-backdrop" id="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <div class="modal-title" id="modal-title">Nəticə</div>
        <button class="btn ghost" id="modal-close">Bağla</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <div class="toast" id="toast">Əməliyyat uğurlu oldu</div>

  <script>
    /*
     * JavaScript Logikası (Daha Təmiz və Modul)
     */

    // Utilities
    const toNum = (v) => {
      if (v == null) return 0;
      const s = String(v).replace(/\s+/g, '').replace(/,/g, '.');
      const n = parseFloat(s);
      return Number.isFinite(n) ? n : 0;
    };
    const fmt = (n) => new Intl.NumberFormat('az-AZ', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n || 0);
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const load = (k, d) => { try { const v = JSON.parse(localStorage.getItem(k)); return v ?? d } catch { return d } };

    // Toast Notification
    let toastTimer;
    const toast = (msg) => {
      const el = document.getElementById('toast');
      el.textContent = msg; el.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => el.classList.remove('show'), 1600);
    };

    // Modal
    const modal = {
      open(title, html) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-body').innerHTML = html;
        const bd = document.getElementById('modal-backdrop');
        bd.classList.add('show');
        bd.setAttribute('aria-hidden', 'false');
      },
      close() {
        const bd = document.getElementById('modal-backdrop');
        bd.classList.remove('show');
        bd.setAttribute('aria-hidden', 'true');
      }
    };

    // TABS Logic
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const target = tab.getAttribute('data-target');
        document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t === tab));
        document.querySelectorAll('.panel').forEach(p => {
          const isTarget = '#' + p.id === target;
          p.classList.toggle('open', isTarget);
          p.setAttribute('aria-hidden', String(!isTarget));
        });
      });
    });

    // Modal Close Listeners
    document.getElementById('modal-close').addEventListener('click', modal.close);
    document.getElementById('modal-backdrop').addEventListener('click', (e) => { if (e.target.id === 'modal-backdrop') modal.close(); });

    // --- KART MƏBLƏĞ LOGIC ---
    const idsKart = ['aide', 'gulshad', 'arzu'];
    const keyKart = 'kartAmounts.v2';

    function loadKart() {
      const st = load(keyKart, { aide: '', gulshad: '', arzu: '' });
      idsKart.forEach(id => { document.getElementById(id).value = st[id] ?? '' });
    }
    function persistKart() {
      const st = Object.fromEntries(idsKart.map(id => [id, document.getElementById(id).value || '']));
      save(keyKart, st);
      toast('Kart məbləğ yadda saxlanıldı');
      document.getElementById('kart-status').textContent = 'Son yaddaş: ' + new Date().toLocaleTimeString('az-AZ');
    }

    idsKart.forEach(id => {
      document.getElementById(id).addEventListener('input', persistKart);
    });

    document.getElementById('btn-kart-calc').addEventListener('click', () => {
      const vals = idsKart.map(id => toNum(document.getElementById(id).value));
      const sum = vals.reduce((a, b) => a + b, 0);
      const names = ['Aidə', 'Gülşad', 'Arzu'];
      const detail = vals.map((val, i) => `
        <div class="row" style="justify-content:space-between; margin-bottom:8px;">
          <span>${names[i]}</span><strong>${fmt(val)}</strong>
        </div>
      `).join('') + `
        <hr style="border:0; border-top:1px solid #3d4a6c; margin:15px 0;"/>
        <div class="row" style="justify-content:space-between; font-size:1.4em; font-weight:700;">
          <span>YEKUN CƏM</span><strong>${fmt(sum)}</strong>
        </div>`;
      modal.open('Kart Məbləğ — Nəticə', detail);
    });

    document.getElementById('btn-kart-reset').addEventListener('click', () => {
      if(!confirm('Kart məbləğlərini sıfırlamaq istədiyinizə əminsinizmi?')) return;
      idsKart.forEach(id => document.getElementById(id).value = '');
      persistKart();
    });

    // --- SMART QALIQ LOGIC ---
    const idsSmart = ['cash1', 'cash2', 'card1', 'card2'];
    const keySmart = 'smartValues.v2';

    function loadSmart() {
      const st = load(keySmart, { cash1: '', cash2: '', card1: '', card2: '' });
      idsSmart.forEach(id => { document.getElementById(id).value = st[id] ?? '' });
    }
    function persistSmart() {
      const st = Object.fromEntries(idsSmart.map(id => [id, document.getElementById(id).value || '']));
      save(keySmart, st);
      toast('Smart qalıq yadda saxlanıldı');
      document.getElementById('smart-status').textContent = 'Son yaddaş: ' + new Date().toLocaleTimeString('az-AZ');
    }

    idsSmart.forEach(id => {
      document.getElementById(id).addEventListener('input', persistSmart);
    });

    document.getElementById('btn-smart-calc').addEventListener('click', () => {
      const v = Object.fromEntries(idsSmart.map(id => [id, toNum(document.getElementById(id).value)]));
      const sumCash = v.cash1 + v.cash2;
      const sumCard = v.card1 + v.card2;
      const total = sumCash + sumCard;
      const html = `
        <div class="row" style="justify-content:space-between; margin-bottom:12px;">
          <span>Nağd Məbləğlər Cəmi</span><strong>${fmt(sumCash)}</strong>
        </div>
        <div class="row" style="justify-content:space-between; margin-bottom:12px;">
          <span>Kart Məbləğləri Cəmi</span><strong>${fmt(sumCard)}</strong>
        </div>
        <hr style="border:0; border-top:1px solid #3d4a6c; margin:15px 0;"/>
        <div class="row" style="justify-content:space-between; font-size:1.4em; font-weight:700;">
          <span>Ümumi Yekun</span><strong>${fmt(total)}</strong>
        </div>`;
      modal.open('Smart Qalıq — Nəticə', html);
    });

    document.getElementById('btn-smart-reset').addEventListener('click', () => {
      if(!confirm('Smart qalıq dəyərlərini sıfırlamaq istədiyinizə əminsinizmi?')) return;
      idsSmart.forEach(id => document.getElementById(id).value = '');
      persistSmart();
    });

    // --- QEYDLƏR LOGIC ---
    const keyNotes = 'notes.v2';

    function renderNotes() {
      const listEl = document.getElementById('notes-list');
      const items = load(keyNotes, []);
      if (!items.length) { listEl.innerHTML = '<div class="muted" style="text-align:center; padding:20px;">Hələ heç bir qeyd yoxdur.</div>'; return; }
      listEl.innerHTML = '';

      for (const note of items) {
        const wrap = document.createElement('div'); wrap.className = 'note-item'; wrap.dataset.id = note.id;
        const textarea = document.createElement('textarea'); textarea.className = 'input note-text'; textarea.rows = 2; textarea.value = note.text; textarea.disabled = true; textarea.style.resize = 'none';
        const actions = document.createElement('div'); actions.className = 'note-actions';
        const btnEdit = document.createElement('button'); btnEdit.className = 'btn ghost'; btnEdit.textContent = 'Düzəliş';
        const btnSave = document.createElement('button'); btnSave.className = 'btn'; btnSave.textContent = 'Yadda Saxla'; btnSave.style.display = 'none';
        const btnDelete = document.createElement('button'); btnDelete.className = 'btn ghost'; btnDelete.textContent = 'Sil';

        actions.append(btnEdit, btnSave, btnDelete);
        wrap.append(textarea, actions); listEl.appendChild(wrap);

        btnEdit.addEventListener('click', () => {
          wrap.classList.add('editing');
          textarea.disabled = false; textarea.focus();
          btnEdit.style.display = 'none'; btnSave.style.display = 'inline-flex';
        });

        btnSave.addEventListener('click', () => {
          wrap.classList.remove('editing');
          textarea.disabled = true; btnSave.style.display = 'none'; btnEdit.style.display = 'inline-flex';
          const all = load(keyNotes, []);
          const idx = all.findIndex(x => x.id === note.id);
          if (idx > -1) { all[idx].text = textarea.value; save(keyNotes, all); toast('Qeyd yeniləndi'); }
        });

        btnDelete.addEventListener('click', () => {
          if(!confirm('Bu qeydi silmək istədiyinizə əminsinizmi?')) return;
          const all = load(keyNotes, []);
          save(keyNotes, all.filter(x => x.id !== note.id));
          renderNotes(); toast('Qeyd silindi');
        });
      }
    }

    document.getElementById('add-note').addEventListener('click', () => {
      const t = document.getElementById('note-text');
      const text = t.value.trim();
      if (!text) { toast('Qeyd mətni boş ola bilməz!'); return; }
      const all = load(keyNotes, []);
      all.unshift({ id: 'n' + Date.now(), text, createdAt: Date.now() });
      save(keyNotes, all); t.value = ''; renderNotes(); toast('Yeni qeyd əlavə olundu');
    });

    // Initial Load
    (function init() {
      loadKart(); loadSmart(); renderNotes();
    })();
  </script>
</body>
</html>
